# Dockerfile para desarrollo del backend
FROM node:20-alpine

WORKDIR /app

# Instalar dependencias globales
RUN npm install -g npm@latest

# Copiar archivos de configuración del workspace
COPY package*.json ./
COPY yarn.lock ./

# Instalar dependencias del monorepo
RUN npm install

# Copiar archivos de configuración del backend
COPY apps/backend/package*.json ./apps/backend/

# Instalar dependencias específicas del backend
WORKDIR /app/apps/backend
RUN npm install

# Volver al directorio de trabajo principal
WORKDIR /app

# Copiar código fuente
COPY apps/backend ./apps/backend

# Exponer puerto
EXPOSE 3001

# Comando por defecto
CMD ["npm", "run", "start:dev", "--workspace=apps/backend"]
